<html>
  <head>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.4.5/aframe/build/aframe-ar.js"></script>
    <script>
      // Simple component to disable frustum culling on a glTF once loaded
      AFRAME.registerComponent('no-frustum-cull', {
        init() {
          this.el.addEventListener('model-loaded', () => {
            this.el.object3D.traverse(o => { if (o.isMesh) o.frustumCulled = false; });
          });
        }
      });
      // Debounce marker visibility: show after N stable frames
      AFRAME.registerComponent('debounced-visibility', {
        schema: { stableFrames: {default: 5} },
        init() {
          let stable = 0;
          const target = this.el;
          target.object3D.visible = false;

          target.addEventListener('markerFound', () => {
            stable = 0;
            this.tick = () => {
              if (stable < this.data.stableFrames) {
                stable++;
                if (stable >= this.data.stableFrames) target.object3D.visible = true;
              }
            };
          });

          target.addEventListener('markerLost', () => {
            target.object3D.visible = false;
            this.tick = () => {};
          });
        }
      });
    </script>
  </head>
  <body style="margin:0; overflow:hidden;">
    <a-scene
      embedded
      renderer="antialias: true; logarithmicDepthBuffer: true"
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam;
            sourceWidth: 1280; sourceHeight: 720;
            displayWidth: 1280; displayHeight: 720;
            detectionMode: mono;
            maxDetectionRate: 60;
            debugUIEnabled: false">

      <a-assets>
        <a-asset-item id="model" src="model.glb"></a-asset-item>
      </a-assets>

      <!-- Marker with smoothing + event emits -->
      <a-marker
        type="pattern"
        url="p_poster.patt"
        emitevents="true"
        smooth="true"
        smoothCount="15"
        smoothTolerance="0.01"
        smoothThreshold="5"
        debounced-visibility="stableFrames: 5">

        <!-- Keep this anchor at neutral scale/position -->
        <a-entity id="anchor" position="0 0 0" rotation="0 0 0">
          <!-- Apply model scale here (keep around 0.05â€“0.3 if your model is large) -->
          <a-entity
            gltf-model="poster.glb"
            scale="0.12 0.12 0.12"
            no-frustum-cull>
          </a-entity>
        </a-entity>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
